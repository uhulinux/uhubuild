#!/bin/bash -eu

if [ -f CMakeLists.txt ]; then
	mkdir -p build
	cd build
	cmake \
		-DCMAKE_INSTALL_PREFIX="/usr" \
		"$@" \
		..
elif [ -f "configure" ]; then
	ub_configure "$@"
else
	if [ -f "autogen.sh" ]; then
		UB_CONFIGURE_SCRIPT="./autogen.sh" ub_configure "$@"
	fi
fi

if [ -f setup.py -a ! -f Makefile ]; then
	if [ "${UB_PYTHON}" = "3" ]; then
		exec python3 ./setup.py build "$@"
	else
		exec python2 ./setup.py build "$@"
	fi
fi

if [ -f Makefile.PL ]; then
	perl Makefile.PL "$@"
fi

if [ -f Build.PL ]; then
	perl Build.PL "$@"
	exec ./Build
fi

if [ -f extconf.rb ]; then
	ruby extconf.rb "$@"
fi

if [ -f /usr/bin/scons -a -f SConstruct -a ! -f Makefile ]; then
	exec scons \
		PREFIX=/usr \
		LIBDIR=/usr/lib \
		"$@"
fi

exec ub_make
