#!/bin/bash -eu

if [ -f CMakeLists.txt ]; then
	mkdir -p build
	cd build
	cmake \
		-DCMAKE_INSTALL_PREFIX="/usr" \
		-DDATA_INSTALL_DIR="/usr/share" \
		-DSYSCONF_INSTALL_DIR="/etc" \
		-DKDE_DEFAULT_HOME=".kde4" \
		"$@" \
		..
elif [ -f "configure" ]; then
	ub_configure "$@"
else
	if [ -f "autogen.sh" ]; then
		UB_CONFIGURE_SCRIPT="./autogen.sh" ub_configure "$@"
	fi
fi

if [ -f setup.py -a ! -f Makefile ]; then
	exec python ./setup.py build "$@"
fi

if [ -f Makefile.PL ]; then
	perl Makefile.PL "$@"
fi

if [ -f Build.PL ]; then
	perl Build.PL "$@"
	exec ./Build
fi

if [ -f extconf.rb ]; then
	ruby extconf.rb "$@"
fi

if [ -f install.rdf -a -d chrome ]; then
	exit 0
fi

if [ -f /usr/bin/scons -a -f SConstruct -a ! -f Makefile ]; then
	exec scons \
		PREFIX=/usr \
		LIBDIR=/usr/lib \
		"$@"
fi

exec ub_make \
	MAN1EXT=1 \
	MAN2EXT=2 \
	MAN3EXT=3 \
	MAN4EXT=4 \
	MAN5EXT=5 \
	MAN6EXT=6 \
	MAN7EXT=7 \
	MAN8EXT=8
